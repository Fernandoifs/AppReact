<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversor usx para JSON</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        textarea { width: 100%; height: 200px; }
        .output { white-space: pre-wrap; background: #f4f4f4; padding: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h2>Conversor de usx para JSON</h2>
    <input type="file" id="fileInput" accept=".usx">
    <button onclick="converterusx()">Converter</button>
    <button onclick="baixarJSON()">Baixar JSON</button>
    <h3>Resultado JSON:</h3>
    <div id="output" class="output"></div>

    <script>
        let nomeArquivo = "output.json";

        function converterusx() {
            const fileInput = document.getElementById("fileInput");
            const output = document.getElementById("output");

            if (fileInput.files.length === 0) {
                alert("Por favor, selecione um arquivo usx.");
                return;
            }

            const file = fileInput.files[0];
            nomeArquivo = file.name.replace(/\.usx$/, ".json");
            const reader = new FileReader();

            reader.onload = function(event) {
                const parser = new DOMParser();
                const usxDoc = parser.parseFromString(event.target.result, "text/xml");
                
                let jsonResult = {
                    biblia: {
                        id: "nlth",
                        versao: "Nova Tradução na Linguagem de Hoje (NTLH)",
                        livros: []
                    }
                };

                const livro = usxDoc.getElementsByTagName("book")[0];
                let livroJSON = {
                    nome: livro.textContent,
                    abreviacao: livro.getAttribute("code"),
                    id: livro.getAttribute("code").toLowerCase(),
                    capitulos: []
                };
                
                let capitulos = usxDoc.getElementsByTagName("chapter");
                for (let cap of capitulos) {
                    let capJSON = {
                        numero: parseInt(cap.getAttribute("number")),
                        id: livroJSON.id + cap.getAttribute("number"),
                        versiculos: []
                    };
                    
                    let versiculos = cap.nextElementSibling;
                    while (versiculos && versiculos.tagName === "para") {
                        let versiculo = versiculos.getElementsByTagName("verse")[0];
                        if (versiculo) {
                            capJSON.versiculos.push({
                                numero: parseInt(versiculo.getAttribute("number")),
                                texto: versiculos.textContent.replace(versiculo.textContent, "").trim()
                            });
                        }
                        versiculos = versiculos.nextElementSibling;
                    }
                    
                    livroJSON.capitulos.push(capJSON);
                }
                
                jsonResult.biblia.livros.push(livroJSON);
                output.textContent = JSON.stringify(jsonResult, null, 4);
            };

            reader.readAsText(file);
        }

        function baixarJSON() {
            const jsonContent = document.getElementById("output").textContent;
            const blob = new Blob([jsonContent], { type: "application/json" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = nomeArquivo;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html>